!function(t){"use strict";const e=["#E05C5C","#F0883E","#D4A017","#4CAF82","#29A8AB","#4A90D9","#8B6FD4","#D46FAB","#5BB8A0","#7DAA44"],i="http://www.w3.org/2000/svg",n={crowded:1/3,normal:1,wide:5/3},o={colors:e,layout:"auto",branchSpacingX:220,subSpacingX:170,verticalSpacing:50,verticalSpacingY:60,horizontalSpacing:30,lineHeight:1.45,center:{fontSize:17,paddingX:28,paddingY:16,radius:12,maxWidth:240,fill:"#1A1F2E",color:"#FFFFFF",shadowColor:"rgba(0,0,0,0.35)"},branch:{fontSize:14,paddingX:18,paddingY:10,radius:99,maxWidth:200,color:"#FFFFFF",shadowColor:"rgba(0,0,0,0.2)"},leaf:{fontSize:13,paddingX:10,paddingY:7,maxWidth:170,color:"#2D3748"},edgeWidth:{root:2.5,branch:2,leaf:1.5},edgeOpacity:.85,minZoom:.08,maxZoom:4,zoomSensitivity:.12,interactions:{pan:!1,zoom:!1,hud:!1,tips:!1,collapse:!1},animationDuration:350,fitPadding:20,spacing:"normal"};function s(t,e){const i=Object.assign({},t);return e?(Object.keys(e).forEach(n=>{e[n]&&"object"==typeof e[n]&&!Array.isArray(e[n])?i[n]=s(t[n]||{},e[n]):i[n]=e[n]}),i):i}function r(t,e){const n=document.createElementNS(i,t);return e&&Object.keys(e).forEach(t=>n.setAttribute(t,e[t])),n}function h(t,e){if(this.container="string"==typeof t?document.querySelector(t):t,!this.container)throw new Error("[Porphyry] Container element not found: "+t);this.options=s(o,e||{}),this._tree=null,this._pz={tx:0,ty:0,scale:1},this._textCache={},this._collapsed=new Set,this._lastData=null,this._buildDOM(),this._bindPanZoom()}function a(t,e){t.direction=e,t.children.forEach(function(t){a(t,e)})}h.prototype._buildDOM=function(){this.container.style.position="relative",this.container.style.overflow="hidden",this.container.style.userSelect="none",this.svg=r("svg",{width:"100%",height:"100%"}),this.svg.style.display="block",this.svg.style.cursor=this.options.interactions.pan?"grab":"default",this.svg.style.transform="translateZ(0)",this.svg.style.willChange="transform";const t=r("defs"),e=r("filter",{id:"mm-shadow-center",x:"-30%",y:"-30%",width:"160%",height:"160%"}),i=r("feDropShadow",{dx:"0",dy:"3",stdDeviation:"5","flood-color":this.options.center.shadowColor});e.appendChild(i),t.appendChild(e);const n=r("filter",{id:"mm-shadow-branch",x:"-30%",y:"-30%",width:"160%",height:"160%"}),o=r("feDropShadow",{dx:"0",dy:"2",stdDeviation:"3.5","flood-color":this.options.branch.shadowColor});n.appendChild(o),t.appendChild(n),this.svg.appendChild(t),this.gMain=r("g"),this.gEdges=r("g",{class:"mm-edges"}),this.gNodes=r("g",{class:"mm-nodes"}),this.gToggles=r("g",{class:"mm-toggles"}),this.gMain.appendChild(this.gEdges),this.gMain.appendChild(this.gNodes),this.gMain.appendChild(this.gToggles),this.svg.appendChild(this.gMain),this.container.appendChild(this.svg),this.options.interactions.hud&&this._buildHUD(),this.options.interactions.tips&&this._buildTips()},h.prototype._buildHUD=function(){const t=this,e=document.createElement("div");e.className="porphyry-hud",e.style.cssText=["position:absolute","bottom:14px","right:14px","display:flex","align-items:center","gap:5px","background:#fff","border:1px solid #E2E8F0","border-radius:10px","padding:4px 9px","box-shadow:0 2px 10px rgba(0,0,0,0.08)","z-index:10","font-family:system-ui,sans-serif"].join(";");const i=["width:26px","height:26px","border:1px solid #E2E8F0","border-radius:6px","background:#F7F8FC","font-size:15px","line-height:1","cursor:pointer","display:flex","align-items:center","justify-content:center","color:#1A202C","transition:all 0.12s","padding:0"].join(";");function n(t,e,n){const o=document.createElement("button");return o.textContent=t,o.title=e,o.style.cssText=i,o.addEventListener("click",n),o.addEventListener("mouseenter",()=>{o.style.background="#EBF4FF",o.style.color="#4A90D9",o.style.borderColor="#4A90D9"}),o.addEventListener("mouseleave",()=>{o.style.background="#F7F8FC",o.style.color="#1A202C",o.style.borderColor="#E2E8F0"}),o}const o=document.createElement("span");o.style.cssText="font-size:12px;font-weight:600;color:#718096;min-width:40px;text-align:center",o.textContent="100%",this._hudZoomLevel=o,e.appendChild(n("−","Zoom out",()=>t._hudZoom(.8))),e.appendChild(o),e.appendChild(n("+","Zoom in",()=>t._hudZoom(1.25))),e.appendChild(n("⤢","Fit to view",()=>t.fit())),this.container.appendChild(e),this._hud=e},h.prototype._hudZoom=function(t){const e=this.container.clientWidth/2,i=this.container.clientHeight/2,n=Math.min(this.options.maxZoom,Math.max(this.options.minZoom,this._pz.scale*t));this._pz.tx=e-(e-this._pz.tx)*(n/this._pz.scale),this._pz.ty=i-(i-this._pz.ty)*(n/this._pz.scale),this._pz.scale=n,this._applyTransform()},h.prototype._buildTips=function(){const t=document.createElement("div");t.className="porphyry-tips",t.style.cssText=["position:absolute","bottom:14px","left:50%","transform:translateX(-50%)","font-size:11.5px","color:#718096","background:#fff","border:1px solid #E2E8F0","border-radius:8px","padding:5px 14px","box-shadow:0 2px 10px rgba(0,0,0,0.08)","white-space:nowrap","pointer-events:none","z-index:10","font-family:system-ui,sans-serif"].join(";"),this.container.appendChild(t),this._tips=t,this._updateTips()},h.prototype._updateTips=function(){if(!this._tips)return;const t=this.options.interactions,e=[];t.zoom&&e.push("Scroll to zoom"),t.pan&&e.push("Drag to pan"),t.collapse&&e.push("+/− to collapse"),e.push("↗ click node to open link"),this._tips.textContent=e.join("  ·  ")},h.prototype.render=function(t){this._collapsed.clear(),this._lastData=t,this._renderInternal(!0)},h.prototype._renderInternal=function(t){if(this.gEdges.innerHTML="",this.gNodes.innerHTML="",this.gToggles.innerHTML="",this._nodeIdCounter=0,this._tree=this._buildTree(this._lastData,null,-1,0),this._assignDirections(this._tree),this._computeSizes(this._tree),this._computeAdaptiveSpacing(this._tree),this._layoutTree(this._tree),this._drawTree(this._tree),t){const t=this;requestAnimationFrame(function(){requestAnimationFrame(function(){t.fit()})})}},h.prototype.fit=function(){if(this._tree)try{const t=this.gMain.getBBox();if(!t||0===t.width)return;const e=this.container.clientWidth,i=this.container.clientHeight,n=this.options.fitPadding,o=(e-2*n)/t.width,s=(i-2*n)/t.height,r=Math.min(o,s,1.4),h=e/2-(t.x+t.width/2)*r,a=i/2-(t.y+t.height/2)*r;this._pz={tx:h,ty:a,scale:r},this._applyTransform()}catch(t){}},h.prototype.reset=function(){this._pz={tx:this.container.clientWidth/2,ty:this.container.clientHeight/2,scale:1},this._applyTransform()},h.prototype._buildTree=function(t,i,n,o){const s={topic:t.topic||"",url:t.url||null,direction:t.direction||null,depth:o,parent:i,colorIdx:n,children:[],_id:this._nodeIdCounter++,x:0,y:0,width:0,height:0,fontSize:0};return Array.isArray(t.children)&&t.children.forEach(function(t,i){const r=0===o?i%e.length:n;s.children.push(this._buildTree(t,s,r,o+1))},this),s},h.prototype._assignDirections=function(t){const e=this.options.layout;if("down"===e||"up"===e)return void t.children.forEach(t=>a(t,e));if("left"===e)return void t.children.forEach(t=>a(t,"left"));if("right"===e)return void t.children.forEach(t=>a(t,"right"));const i=t.children.filter(t=>"left"===t.direction||"right"===t.direction),n=t.children.filter(t=>!t.direction);let o=i.filter(t=>"right"===t.direction).length,s=i.filter(t=>"left"===t.direction).length;n.forEach(t=>{o<=s?(t.direction="right",o++):(t.direction="left",s++)}),t.children.forEach(t=>a(t,t.direction))},h.prototype._measureText=function(t,e){const i=t+":"+e;if(this._textCache[i])return this._textCache[i];this._measureCanvas||(this._measureCanvas=document.createElement("canvas"),this._measureCtx=this._measureCanvas.getContext("2d")),this._measureCtx.font="bold "+e+'px system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif';const n=this._measureCtx.measureText(t).width;return this._textCache[i]=n,n},h.prototype._computeSizes=function(t){const e=this.options;let i,n,o,s;0===t.depth?(i=e.center.fontSize,n=e.center.paddingX,o=e.center.paddingY,s=e.center.maxWidth):1===t.depth?(i=e.branch.fontSize,n=e.branch.paddingX,o=e.branch.paddingY,s=e.branch.maxWidth):(i=e.leaf.fontSize,n=e.leaf.paddingX,o=e.leaf.paddingY,s=e.leaf.maxWidth);const r=t.url?25:0,h=s-2*n-r,a=t=>this._measureText(t,i),d=function(t,e,i){const n=t.split(/\s+/).filter(Boolean);if(!n.length)return[""];const o=[];let s="";return n.forEach(t=>{(i(t)>e?function(t){const n=[];let o="";for(let s=0;s<t.length;s++){const r=o+t[s];i(r)<=e?o=r:(o&&n.push(o),o=t[s])}return o&&n.push(o),n.length?n:[t]}(t):[t]).forEach(t=>{const n=s?s+" "+t:t;i(n)<=e?s=n:(s&&o.push(s),s=t)})}),s&&o.push(s),o}(t.topic,h,a),c=d.reduce((t,e)=>Math.max(t,a(e)),0),l=i*e.lineHeight;t.fontSize=i,t.lineHeight=l,t.paddingX=n,t.paddingY=o,t.lines=d,t.width=Math.ceil(Math.min(c+2*n+r,s)),t.height=Math.ceil(d.length*l+2*o),t.children.forEach(t=>this._computeSizes(t))},h.prototype._maxDepth=function(t){return t.children.length?Math.max(...t.children.map(t=>this._maxDepth(t))):t.depth},h.prototype._computeAdaptiveSpacing=function(t){const e=this.options,i=n[e.spacing]||1;if("up"===e.layout||"down"===e.layout)return void(this._sp={branchSpacingX:Math.round(e.branchSpacingX*i),subSpacingX:Math.round(e.subSpacingX*i),verticalSpacingY:Math.round(e.verticalSpacingY*i),horizontalSpacing:Math.round(e.horizontalSpacing*i),verticalSpacing:Math.round(e.verticalSpacing*i)});const o=this._maxDepth(t),s=i*(o<=2?1:Math.max(.45,2.5/o));this._sp={branchSpacingX:Math.round(e.branchSpacingX*s),subSpacingX:Math.round(e.subSpacingX*s),verticalSpacingY:Math.round(e.verticalSpacingY*i),horizontalSpacing:Math.round(e.horizontalSpacing*i),verticalSpacing:Math.round(e.verticalSpacing*i)}},h.prototype._subtreeHeight=function(t){const e=this._sp?this._sp.verticalSpacing:this.options.verticalSpacing;if(!t.children.length||this._collapsed.has(t._id))return t.height+e;const i=t.children.reduce((t,e)=>t+this._subtreeHeight(e),0);return Math.max(i,t.height+e)},h.prototype._layoutTree=function(t){t.x=0,t.y=0;const e=this.options.layout;if("down"===e||"up"===e)return void this._layoutVerticalNode(t,"down"===e?1:-1);const i=t.children.filter(t=>"right"===t.direction),n=t.children.filter(t=>"left"===t.direction);this._layoutSide(t,i,"right"),this._layoutSide(t,n,"left")},h.prototype._subtreeWidth=function(t){const e=this._sp?this._sp.horizontalSpacing:this.options.horizontalSpacing;if(!t.children.length||this._collapsed.has(t._id))return t.width+e;const i=t.children.reduce((t,e)=>t+this._subtreeWidth(e),0);return Math.max(i,t.width+e)},h.prototype._layoutVerticalNode=function(t,e){if(!t.children.length||this._collapsed.has(t._id))return;const i=this.options,n=t.y+e*(t.height/2+(this._sp?this._sp.verticalSpacingY:i.verticalSpacingY)),o=t.children.map(t=>this._subtreeWidth(t)),s=o.reduce((t,e)=>t+e,0);let r=t.x-s/2;t.children.forEach((t,i)=>{t.x=r+o[i]/2,t.y=n+e*t.height/2,this._layoutVerticalNode(t,e),r+=o[i]})},h.prototype._layoutSide=function(t,e,i){if(!e.length)return;const n=this._sp,o="right"===i?t.width/2+n.branchSpacingX:-(t.width/2+n.branchSpacingX),s=e.map(t=>this._subtreeHeight(t));let r=-s.reduce((t,e)=>t+e,0)/2;e.forEach((t,e)=>{const n=r+s[e]/2;this._layoutNode(t,o,n,i),r+=s[e]})},h.prototype._layoutNode=function(t,e,i,n){const o=this._sp;if(t.x="right"===n?e+t.width/2:e-t.width/2,t.y=i,!t.children.length||this._collapsed.has(t._id))return;const s="right"===n?t.x+t.width/2+o.subSpacingX:t.x-t.width/2-o.subSpacingX,r=t.children.map(t=>this._subtreeHeight(t));let h=i-r.reduce((t,e)=>t+e,0)/2;t.children.forEach((t,e)=>{this._layoutNode(t,s,h+r[e]/2,n),h+=r[e]})},h.prototype._drawTree=function(t){this._drawNode(t),this._drawSubtree(t),this.options.interactions.collapse&&this._drawAllToggles(t)},h.prototype._drawSubtree=function(t){this._collapsed.has(t._id)||t.children.forEach(e=>{this._drawEdge(t,e),this._drawNode(e),this._drawSubtree(e)})},h.prototype._drawNode=function(t){const e=this.options,i=!!t.url,n=e.layout,o="up"===n||"down"===n,s=r("g",{class:"mm-node"+(i?" mm-node-linked":""),"data-depth":t.depth}),h=i?t.x-12.5:t.x;if(o){const n=0===t.depth?e.center.fill:e.colors[t.colorIdx],o=0===t.depth?e.center.fill:e.colors[t.colorIdx],a=0===t.depth?"700":1===t.depth?"600":"500",d=0===t.depth?"2.5":"2",c=1===t.lines.length?t.height/2:10,l=0===t.depth?"url(#mm-shadow-center)":1===t.depth?"url(#mm-shadow-branch)":"",p=r("rect",{x:t.x-t.width/2,y:t.y-t.height/2,width:t.width,height:t.height,rx:c,ry:c,fill:"#FFFFFF",stroke:n,"stroke-width":d});l&&p.setAttribute("filter",l),s.appendChild(p),s.appendChild(this._makeText(t.lines,h,t.y,t.fontSize,t.lineHeight,o,a)),i&&s.appendChild(this._makeLinkIcon(t,n))}else if(0===t.depth){const n=r("rect",{x:t.x-t.width/2,y:t.y-t.height/2,width:t.width,height:t.height,rx:e.center.radius,ry:e.center.radius,fill:e.center.fill,filter:"url(#mm-shadow-center)"});s.appendChild(n),s.appendChild(this._makeText(t.lines,h,t.y,t.fontSize,t.lineHeight,e.center.color,"700")),i&&s.appendChild(this._makeLinkIcon(t,"rgba(255,255,255,0.7)"))}else if(1===t.depth){const n=e.colors[t.colorIdx],o=1===t.lines.length?t.height/2:10,a=r("rect",{x:t.x-t.width/2,y:t.y-t.height/2,width:t.width,height:t.height,rx:o,ry:o,fill:n,filter:"url(#mm-shadow-branch)"});s.appendChild(a),s.appendChild(this._makeText(t.lines,h,t.y,t.fontSize,t.lineHeight,e.branch.color,"600")),i&&s.appendChild(this._makeLinkIcon(t,"rgba(255,255,255,0.8)"))}else{const n=e.colors[t.colorIdx],o=r("rect",{x:t.x-t.width/2,y:t.y-t.height/2,width:t.width,height:t.height,rx:3,ry:3,fill:n,opacity:i?"0.14":"0.08"});s.appendChild(o);const a=r("line",{x1:t.x-t.width/2,y1:t.y+t.height/2,x2:t.x+t.width/2,y2:t.y+t.height/2,stroke:n,"stroke-width":"1.8","stroke-linecap":"round"});s.appendChild(a),s.appendChild(this._makeText(t.lines,h,t.y,t.fontSize,t.lineHeight,e.leaf.color,"500")),i&&s.appendChild(this._makeLinkIcon(t,n))}s.style.transition="opacity 0.15s",s.style.willChange="opacity",s.addEventListener("mouseenter",()=>{s.style.opacity="0.82",i&&(this.svg.style.cursor="pointer")}),s.addEventListener("mouseleave",()=>{s.style.opacity="1",i&&(this.svg.style.cursor=this.options.interactions.pan?this._dragging?"grabbing":"grab":"default")}),i&&s.addEventListener("click",e=>{this._dragMoved||(e.stopPropagation(),window.open(t.url,"_blank","noopener,noreferrer"))}),this.gNodes.appendChild(s)},h.prototype._drawAllToggles=function(t){t.depth>0&&t.children.length>0&&this._drawCollapseBtn(t),this._collapsed.has(t._id)||t.children.forEach(t=>this._drawAllToggles(t))},h.prototype._drawCollapseBtn=function(t){const e=this,i=this.options,n=this._collapsed.has(t._id),o=i.layout;let s,h;if("up"===o||"down"===o)s=t.x,h="down"===o?t.y+t.height/2+8+1:t.y-t.height/2-8-1;else{const e=t.direction||"right";h=t.y,s="right"===e?t.x+t.width/2+8+1:t.x-t.width/2-8-1}const a=i.colors[t.colorIdx]||i.center.fill,d=r("g",{class:"mm-collapse-btn",cursor:"pointer"}),c=r("circle",{cx:s,cy:h,r:8,fill:"#fff",stroke:a,"stroke-width":"1.8"}),l=r("text",{x:s,y:h,"text-anchor":"middle","dominant-baseline":"central","font-size":"13","font-weight":"700",fill:a,"pointer-events":"none",style:"font-family:system-ui,sans-serif;user-select:none"});l.textContent=n?"+":"−",d.appendChild(c),d.appendChild(l),d.addEventListener("mouseenter",function(){c.setAttribute("fill",a),l.setAttribute("fill","#fff")}),d.addEventListener("mouseleave",function(){c.setAttribute("fill","#fff"),l.setAttribute("fill",a)}),d.addEventListener("click",function(i){i.stopPropagation(),n?e._collapsed.delete(t._id):e._collapsed.add(t._id),e._renderInternal(!1)}),this.gToggles.appendChild(d)},h.prototype._makeLinkIcon=function(t,e){const n=t.x+t.width/2-12-9,o=t.y-4.5,s=r("g",{"pointer-events":"none"}),h=document.createElementNS(i,"path");h.setAttribute("d",`\n      M ${n+3} ${o}\n      H ${n+9}\n      V ${o+9}\n      H ${n}\n      V ${o+3}\n    `),h.setAttribute("stroke",e),h.setAttribute("stroke-width","1.4"),h.setAttribute("fill","none"),h.setAttribute("stroke-linecap","round"),h.setAttribute("stroke-linejoin","round"),s.appendChild(h);const a=document.createElementNS(i,"path");return a.setAttribute("d",`M ${n} ${o+9} L ${n-5} ${o+9+5}`),a.setAttribute("stroke",e),a.setAttribute("stroke-width","1.4"),a.setAttribute("stroke-linecap","round"),s.appendChild(a),s},h.prototype._makeText=function(t,e,n,o,s,r,h){const a=document.createElementNS(i,"text");a.setAttribute("text-anchor","middle"),a.setAttribute("fill",r),a.setAttribute("font-size",o),a.setAttribute("font-family",'system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, sans-serif'),a.setAttribute("font-weight",h||"normal"),a.setAttribute("pointer-events","none");const d=n-(t.length-1)*s/2;return t.forEach((t,n)=>{const o=document.createElementNS(i,"tspan");o.setAttribute("x",e),o.setAttribute("y",d+n*s),o.setAttribute("dominant-baseline","central"),o.textContent=t,a.appendChild(o)}),a},h.prototype._drawEdge=function(t,e){const n=this.options,o=n.layout;if("down"===o||"up"===o)return void this._drawEdgeVertical(t,e,o);const s=n.colors[e.colorIdx],r=e.direction;let h,a;0===t.depth?(h="right"===r?t.width/2:-t.width/2,a=t.y):(h="right"===r?t.x+t.width/2:t.x-t.width/2,a=1===t.depth?t.y:t.y+t.height/2);const d="right"===r?e.x-e.width/2:e.x+e.width/2,c=e.depth>1?e.y+e.height/2:e.y,l=(h+d)/2,p=`M ${h} ${a} C ${l} ${a}, ${l} ${c}, ${d} ${c}`,u=0===t.depth?n.edgeWidth.root:1===t.depth?n.edgeWidth.branch:n.edgeWidth.leaf,g=document.createElementNS(i,"path");g.setAttribute("d",p),g.setAttribute("stroke",s),g.setAttribute("stroke-width",u),g.setAttribute("fill","none"),g.setAttribute("stroke-linecap","round"),g.setAttribute("opacity",n.edgeOpacity),this.gEdges.appendChild(g)},h.prototype._drawEdgeVertical=function(t,e,n){const o=this.options,s="down"===n?1:-1,r=o.colors[e.colorIdx],h=t.x,a=t.y+s*t.height/2,d=e.x,c=e.y-s*e.height/2,l=(a+c)/2,p=`M ${h} ${a} C ${h} ${l}, ${d} ${l}, ${d} ${c}`,u=0===t.depth?o.edgeWidth.root:1===t.depth?o.edgeWidth.branch:o.edgeWidth.leaf,g=document.createElementNS(i,"path");g.setAttribute("d",p),g.setAttribute("stroke",r),g.setAttribute("stroke-width",u),g.setAttribute("fill","none"),g.setAttribute("stroke-linecap","round"),g.setAttribute("opacity",o.edgeOpacity),this.gEdges.appendChild(g)},h.prototype._applyTransform=function(){const{tx:t,ty:e,scale:i}=this._pz;this.gMain.setAttribute("transform",`translate(${t},${e}) scale(${i})`),this._hudZoomLevel&&(this._hudZoomLevel.textContent=Math.round(100*i)+"%")},h.prototype._bindPanZoom=function(){const t=this;if(this._dragging=!1,this._dragMoved=!1,!this.options.interactions.pan&&!this.options.interactions.zoom)return;let e=!1,i=0,n=0,o=0,s=0;if(this.options.interactions.pan&&(this.svg.addEventListener("mousedown",function(r){0===r.button&&(e=!0,t._dragging=!0,t._dragMoved=!1,i=r.clientX-t._pz.tx,n=r.clientY-t._pz.ty,o=r.clientX,s=r.clientY,t.svg.style.cursor="grabbing",r.preventDefault())}),window.addEventListener("mousemove",function(r){if(!e)return;const h=r.clientX-o,a=r.clientY-s;(Math.abs(h)>5||Math.abs(a)>5)&&(t._dragMoved=!0),t._pz.tx=r.clientX-i,t._pz.ty=r.clientY-n,t._applyTransform()}),window.addEventListener("mouseup",function(){e&&(e=!1,t._dragging=!1,t.svg.style.cursor="grab",setTimeout(()=>{t._dragMoved=!1},0))})),this.options.interactions.zoom&&this.svg.addEventListener("wheel",function(e){e.preventDefault();const i=t.container.getBoundingClientRect(),n=e.clientX-i.left,o=e.clientY-i.top,s=1+(e.deltaY<0?1:-1)*t.options.zoomSensitivity,r=Math.min(t.options.maxZoom,Math.max(t.options.minZoom,t._pz.scale*s));t._pz.tx=n-(n-t._pz.tx)*(r/t._pz.scale),t._pz.ty=o-(o-t._pz.ty)*(r/t._pz.scale),t._pz.scale=r,t._applyTransform()},{passive:!1}),this.options.interactions.pan||this.options.interactions.zoom){let o=0;this.svg.addEventListener("touchstart",function(s){if(1===s.touches.length&&t.options.interactions.pan)e=!0,i=s.touches[0].clientX-t._pz.tx,n=s.touches[0].clientY-t._pz.ty;else if(2===s.touches.length&&t.options.interactions.zoom){e=!1;const t=s.touches[0],i=s.touches[1];o=Math.hypot(i.clientX-t.clientX,i.clientY-t.clientY)}},{passive:!0}),this.svg.addEventListener("touchmove",function(s){if(s.preventDefault(),1===s.touches.length&&e&&t.options.interactions.pan)t._pz.tx=s.touches[0].clientX-i,t._pz.ty=s.touches[0].clientY-n,t._applyTransform();else if(2===s.touches.length&&t.options.interactions.zoom){const e=s.touches[0],i=s.touches[1],n=Math.hypot(i.clientX-e.clientX,i.clientY-e.clientY),r=(e.clientX+i.clientX)/2,h=(e.clientY+i.clientY)/2,a=t.container.getBoundingClientRect(),d=r-a.left,c=h-a.top;if(o){const e=n/o,i=Math.min(t.options.maxZoom,Math.max(t.options.minZoom,t._pz.scale*e));t._pz.tx=d-(d-t._pz.tx)*(i/t._pz.scale),t._pz.ty=c-(c-t._pz.ty)*(i/t._pz.scale),t._pz.scale=i,t._applyTransform()}o=n}},{passive:!1}),this.svg.addEventListener("touchend",function(){e=!1,o=0},{passive:!0})}},h.prototype._rebindInteractions=function(){this.svg.style.cursor=this.options.interactions.pan?"grab":"default";const t=this.svg,e=t.cloneNode(!0);this.svg=e,t.parentNode.replaceChild(e,t),this.gMain=e.querySelector(".mm-edges").parentNode,this.gEdges=e.querySelector(".mm-edges"),this.gNodes=e.querySelector(".mm-nodes"),this.gToggles=e.querySelector(".mm-toggles"),this._bindPanZoom(),this._updateTips()},"undefined"!=typeof module&&module.exports?module.exports=h:t.Porphyry=h}("undefined"!=typeof window?window:this);